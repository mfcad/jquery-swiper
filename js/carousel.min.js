(function($) {
	var defaluts = {
		large_elem: ".large_elem",
		small_elem: ".small_elem",
		left_btn: ".left_btn",
		right_btn: ".right_btn",
		state: "on",
		speed: "normal",
		vis: 7,
		autoplay: true,
		autotime: 500000000,
		small_left_btn: "small_left_btn",
		small_right_btn: "small_right_btn",
	};
	$.fn.extend({
		"thumbnailImg": function(options) {
			var opts = $.extend({}, defaluts, options);
			return this.each(function() {
				var $this = $(this);
				var t = 0;
				$(opts.large_elem).find("ul li").eq(0).show();
				$(opts.small_elem).find("ul li").eq(0).addClass(opts.state);
				var l = $(opts.small_elem).find("ul li").length;
				var l_mean;
				if (l < opts.vis) {
					l_mean = 0
				} else {
					l_mean = ((parseInt(l / opts.vis) - 1) * opts.vis) + (l % opts.vis)
				}
				var w = $(opts.small_elem).find("ul li").outerWidth(true);
				$(opts.small_elem).find("ul").css("width", l * w + "px");
				$(opts.small_elem).find("ul li").click(function() {
					$(this).addClass(opts.state).siblings().removeClass(opts.state);
					t = $(this).index();
					Img($(this).index());
					/*下边小图，判断全屏按钮显示不显示,第一个和最后一个不显示*/
					if (t == 0 || t == ($(opts.small_elem).find("ul li").length - 1)) {
						$('.proscreen_btn').hide();
					} else {
						$('.proscreen_btn').show();
					}
				});
				window.onresize = function() {
					if (!checkFull()) {
						// 要执行的动作
						exitFull();
					}
				}

				function checkFull() {
					var isFull =
						document.fullscreenElement ||
						document.mozFullScreenElement ||
						document.webkitFullscreenElement
					if (isFull === undefined) isFull = false
					return isFull
				}

				function left_temp() {
					var i;
					$(opts.small_elem).find("ul li").each(function(index) {
						if ($(this).hasClass(opts.state)) {
							i = index
						}
					});
					i--;
					if (i < 0) {
						i = l - 1
					}
					$(opts.small_elem).find("ul li").eq(i).addClass(opts.state).siblings()
						.removeClass(opts.state);
					var ml = i * w;
					if (ml <= l_mean * w) {
						$(opts.small_elem).find("ul").stop().animate({
							marginLeft: -ml + "px"
						}, opts.speed)
					} else {
						$(opts.small_elem).find("ul").stop().animate({
							marginLeft: -(l_mean * w) + "px"
						}, opts.speed)
					}
					t = i;
					/*大图左箭头，判断全屏按钮显示不显示,第一个和最后一个不显示*/
					if (t == 0 || t == ($(opts.small_elem).find("ul li").length - 1)) {
						$('.proscreen_btn').hide();
					} else {
						$('.proscreen_btn').show();
					}
					return t;
				}

				function rigth_temp() {
					var i;
					$(opts.small_elem).find("ul li").each(function(index) {
						if ($(this).hasClass(opts.state)) {
							i = index
						}
					});
					i++;
					if (i > l - 1) {
						i = 0
					}
					$(opts.small_elem).find("ul li").eq(i).addClass(opts.state).siblings()
						.removeClass(opts.state);
					var ml = i * w;
					if (ml <= l_mean * w) {
						$(opts.small_elem).find("ul").stop().animate({
							marginLeft: -ml + "px"
						}, opts.speed)
					} else {
						$(opts.small_elem).find("ul").stop().animate({
							marginLeft: -(l_mean * w) + "px"
						}, opts.speed)
					}
					t = i;
					/*大图右箭头，判断全屏按钮显示不显示,第一个和最后一个不显示*/
					if (t == 0 || t == ($(opts.small_elem).find("ul li").length - 1)) {
						$('.proscreen_btn').hide();
					} else {
						$('.proscreen_btn').show();
					}
					return t;
				}

				$(opts.left_btn).click(function() {
					var i = left_temp();
					Img(i)
				});
				$(opts.right_btn).click(function() {
					var i = rigth_temp();
					Img(i)
				});

				$(".showImg2_btnRight").click(function() {
					var t = rigth_temp();
					var checkimg = $(opts.large_elem).find("ul li").eq(t);
					var imgsrc = checkimg.find('img').attr('src');
					setImg2(imgsrc);
					enterFull();

				})

				$(".showImg2_btnLeft").click(function() {
					var t = left_temp();
					var checkimg = $(opts.large_elem).find("ul li").eq(t);
					var imgsrc = checkimg.find('img').attr('src');
					setImg2(imgsrc);
					enterFull();
				})

				//下边右边切换
				$(opts.small_right_btn).click(function() {
					var target = 'px';
					var show_total = $(".small_box").width();
					var cdtotal = l_mean * w + (show_total / 2);;
					var yiwith = $(opts.small_elem).find("ul").css('marginLeft');
					var res_weith = Math.abs(yiwith.replace(target, ''));
					var shyu = cdtotal - res_weith;
					var goleft = 0;
					if (shyu > show_total) {
						goleft = res_weith + (show_total);
					} else {
						goleft = res_weith + shyu;
					}
					$(opts.small_elem).find("ul").animate({
						marginLeft: -goleft + "px"
					}, opts.speed)
				});
				//下边左边切换
				$(opts.small_left_btn).click(function() {
					var target = 'px';
					var show_total = $(".small_box").width();
					var cdtotal = l_mean * w + (show_total / 2);
					var yiwith = $(opts.small_elem).find("ul").css('marginLeft');
					var res_weith = Math.abs(yiwith.replace(target, ''));
					var shyu = cdtotal - res_weith;
					var goleft = 0;
					if (res_weith <= show_total) {
						goleft = goleft;
					} else {
						goleft = res_weith - show_total; //show_total
					}
					$(opts.small_elem).find("ul").animate({
						marginLeft: -goleft + "px"
					}, opts.speed)
				});

				//叉号退出
				$("body").on('click', ".btnExitFullScreen", function() {
					exitFull();
				});

				//全屏
				$(".btnImgFullScreen").click(function() {
					var dq;
					$(opts.small_elem).find("ul li").each(function(index) {
						if ($(this).hasClass(opts.state)) {
							dq = index
						}
					});
					if (dq == 0) {
						return false;
					}
					var lenths = $(opts.small_elem).find("ul li").length;
					if (dq == lenths) {
						return false;
					}
					var checkimg = $(opts.large_elem).find("ul li").eq(dq);
					var imgsrc = checkimg.find('img').attr('src');
					setImg2(imgsrc);
					enterFull();
				})

				function enterFull() {
					var self = this;
					enterFullscreen();
					$(".banner").css('opacity', '0');
					$('.container2').show();
					/* setTimeout(function(){ 
					  $('.large_box').find('li').eq(index).trigger('click'); 
					},500); */
					//esc keyCode:27 
					/* */
				}
				$('body').on('keydown', function(e) {
					exitFull();
					if (e.keyCode == 27) {
						e.stopPropagation();
						$(".banner").css('opacity', '1');
						$('.container2').hide();
					};
				});

				function exitFull() {
					$(document).off('keyup.a');
					$(".banner").css('opacity', '1');
					$('.container2').hide();
					/* animateEvent.showStart(); 
					setTimeout(function(){ 			
						$('.large_box').find('li').eq(index).trigger('click'); 
					},500); */
					exitFullscreen();
				}

				function setImg2(src) {

					var $imgBox2 = $('.imgBox2');
					var $img2 = $('.img2');

					/*  $imgBox2; 
					  $img2; */
					var bW, bH, mW, mH;
					var img = new Image();
					$img2.attr('src', src);
					img.onload = function() {
						mW = img.width;
						mH = img.height;
						bW = $imgBox2.width();
						bH = $imgBox2.height();


						// setPosition(); 

						var sScale = Math.min(bW / mW, bH / mH);
						if (sScale >= 1) {
							$img2.css({
								'width': mW,
								'height': mH,
								'left': (bW - mW) / 2,
								'top': (bH - mH) / 2
							});
						} else {
							$img2.css({
								'width': mW * sScale,
								'height': mH * sScale,
								'left': (bW - mW * sScale) / 2,
								'top': (bH - mH * sScale) / 2
							});
						};

						// setPosition();
					};
					img.src = src;
				}

				/* function setPosition(){ 
						var sScale = Math.min(bW/mW,bH/mH); 
						if( sScale>=1 ){ 
						  $img2.css({ 
							'width': mW, 
							'height': mH, 
							'left': (bW-mW)/2, 
							'top': (bH-mH)/2 
						  }); 
						}else{ 
						  $img2.css({ 
							'width': mW*sScale, 
							'height': mH*sScale, 
							'left': (bW-mW*sScale)/2, 
							'top': (bH-mH*sScale)/2 
						  }); 
						}; 
				  }; */

				// 判断各种浏览器
				function enterFullscreen() {
					var element = document.documentElement;
					if (element.requestFullscreen) {
						element.requestFullscreen();
					} else if (element.mozRequestFullScreen) {
						element.mozRequestFullScreen();
					} else if (element.webkitRequestFullscreen) {
						element.webkitRequestFullscreen();
					} else if (element.msRequestFullscreen) {
						element.msRequestFullscreen();
					}
				}

				// 判断浏览器种类 
				function exitFullscreen() {
					if (document.exitFullScreen) {
						document.exitFullscreen()
					}
					//兼容火狐
					if (document.mozCancelFullScreen) {
						document.mozCancelFullScreen()
					}
					//兼容谷歌等
					if (document.webkitExitFullscreen) {
						document.webkitExitFullscreen()
					}
					//兼容IE
					if (document.msExitFullscreen) {
						document.msExitFullscreen()
					}
				}

				function Img(i) {
					$(opts.large_elem).find("ul li").removeClass('shows');
					$(opts.large_elem).find("ul li").eq(i).addClass('shows').siblings().hide();
					
					$(opts.small_elem).find("ul li").eq(i).addClass(opts.state).siblings().removeClass(opts.state);
					var ml = 0;
					if (i > 3) {
						ml = (i - 3) * w;
					}else if(i<=3){
						ml = 0;
					} else {
						ml = i * w;
					}
					$(opts.small_elem).find("ul").stop().animate({
						marginLeft: -ml + "px"
					}, opts.speed)
				}
				if (opts.autoplay) {
					var timing = setInterval(function() {
						t++;
						if (t > l - 1) {
							t = 0
						}
						Img(t)
					}, opts.autotime);
					$this.hover(function() {
						clearInterval(timing)
					}, function() {
						timing = setInterval(function() {
							t++;
							if (t > l - 1) {
								t = 0
							}
							Img(t)
						}, opts.autotime)
					})
				}
			})
		}
	})
})(jQuery);
